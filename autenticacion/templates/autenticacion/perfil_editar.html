{% extends 'base.html' %}

{% block title %}{{ titulo }} - AgroControl{% endblock %}
{% block page_title %}{{ titulo }}{% endblock %}

{% block page_actions %}
<a href="{% url 'perfil_usuario' %}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left me-2"></i>Volver
</a>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card card-agro">
            <div class="card-header bg-agro-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-person-gear me-2"></i>{{ titulo }}
                </h5>
            </div>
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                    {% endif %}
                    
                    <div class="row">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">Información de Acceso</h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.nombre_usuario.id_for_label }}" class="form-label">
                                {{ form.nombre_usuario.label }}
                            </label>
                            {{ form.nombre_usuario }}
                            <div class="form-text">El nombre de usuario no se puede cambiar.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.correo_electronico.id_for_label }}" class="form-label">
                                {{ form.correo_electronico.label }}
                            </label>
                            {{ form.correo_electronico }}
                            {% if form.correo_electronico.errors %}
                            <div class="text-danger small mt-1">{{ form.correo_electronico.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.password.id_for_label }}" class="form-label">
                                {{ form.password.label }}
                            </label>
                            <div class="input-group">
                                {{ form.password }}
                                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="{{ form.password.id_for_label }}">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            {% if form.password.help_text %}
                            <small class="form-text text-muted">{{ form.password.help_text }}</small>
                            {% endif %}
                            {% if form.password.errors %}
                            <div class="text-danger small mt-1">{{ form.password.errors.as_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.password_confirm.id_for_label }}" class="form-label">
                                {{ form.password_confirm.label }}
                            </label>
                            <div class="input-group">
                                {{ form.password_confirm }}
                                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="{{ form.password_confirm.id_for_label }}">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            {% if form.password_confirm.errors %}
                            <div class="text-danger small mt-1">{{ form.password_confirm.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12 mb-2">
                            <h6 class="border-bottom pb-2 mb-3">Información Personal</h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.nombres.id_for_label }}" class="form-label">
                                {{ form.nombres.label }}
                            </label>
                            {{ form.nombres }}
                            {% if form.nombres.errors %}
                            <div class="text-danger small mt-1">{{ form.nombres.errors.as_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.apellidos.id_for_label }}" class="form-label">
                                {{ form.apellidos.label }}
                            </label>
                            {{ form.apellidos }}
                            {% if form.apellidos.errors %}
                            <div class="text-danger small mt-1">{{ form.apellidos.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'perfil_usuario' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-2"></i>Cancelar
                        </a>
                        <button type="submit" class="btn btn-agro-primary">
                            <i class="bi bi-check-circle me-2"></i>{{ boton_texto }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function togglePasswordVisibility(button) {
        const targetId = button.getAttribute('data-target');
        if (!targetId) return;
        
        const passwordInput = document.getElementById(targetId);
        if (!passwordInput) return;

        const icon = button.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            passwordInput.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }
    
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
            togglePasswordVisibility(this);
        });
    });
});
</script>

<style>
.input-group .form-control { border-right: 0; }
.input-group .btn { border-left: 0; border-color: #ced4da; }
.input-group .btn:hover { background-color: #e9ecef; border-color: #ced4da; }
</style>
{% endblock %}